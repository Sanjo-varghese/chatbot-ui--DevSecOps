<h1 align="center">Hi ðŸ‘‹, I'm sanjo Varghese</h1>
<h3 align="center">A passionate IT proffesional</h3>

- ðŸŒ± Iâ€™m currently learning **Python**

- ðŸ’¬ Ask me about **Cloud,Cyber security,System**

- ðŸ“« How to reach me **sanjovarghese484@gmail.com**

- âš¡ Fun fact **Iam a Noob**

<h3 align="left">Connect with me:</h3>
<p align="left">
<a href="https://linkedin.com/in/sanjo-varghese-18a016269" target="blank"><img align="center" src="https://raw.githubusercontent.com/rahuldkjain/github-profile-readme-generator/master/src/images/icons/Social/linked-in-alt.svg" alt="sanjo-varghese-18a016269" height="30" width="40" /></a>
<a href="https://fb.com/sanjovarghese.net" target="blank"><img align="center" src="https://raw.githubusercontent.com/rahuldkjain/github-profile-readme-generator/master/src/images/icons/Social/facebook.svg" alt="sanjovarghese.net" height="30" width="40" /></a>
<a href="https://instagram.com/sanjo._.varghese" target="blank"><img align="center" src="https://raw.githubusercontent.com/rahuldkjain/github-profile-readme-generator/master/src/images/icons/Social/instagram.svg" alt="sanjo._.varghese" height="30" width="40" /></a>
</p>

<h3 align="left">Languages and Tools:</h3>
<p align="left"> <a href="https://www.arduino.cc/" target="_blank" rel="noreferrer"> <img src="https://cdn.worldvectorlogo.com/logos/arduino-1.svg" alt="arduino" width="40" height="40"/> </a> <a href="https://aws.amazon.com" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/amazonwebservices/amazonwebservices-original-wordmark.svg" alt="aws" width="40" height="40"/> </a> <a href="https://azure.microsoft.com/en-in/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/microsoft_azure/microsoft_azure-icon.svg" alt="azure" width="40" height="40"/> </a> <a href="https://www.cprogramming.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/c/c-original.svg" alt="c" width="40" height="40"/> </a> <a href="https://www.w3schools.com/cpp/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/cplusplus/cplusplus-original.svg" alt="cplusplus" width="40" height="40"/> </a> <a href="https://www.docker.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/docker/docker-original-wordmark.svg" alt="docker" width="40" height="40"/> </a> <a href="https://dotnet.microsoft.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/dot-net/dot-net-original-wordmark.svg" alt="dotnet" width="40" height="40"/> </a> <a href="https://cloud.google.com" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/google_cloud/google_cloud-icon.svg" alt="gcp" width="40" height="40"/> </a> <a href="https://git-scm.com/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/git-scm/git-scm-icon.svg" alt="git" width="40" height="40"/> </a> <a href="https://grafana.com" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/grafana/grafana-icon.svg" alt="grafana" width="40" height="40"/> </a> <a href="https://www.w3.org/html/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/html5/html5-original-wordmark.svg" alt="html5" width="40" height="40"/> </a> <a href="https://www.adobe.com/in/products/illustrator.html" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/adobe_illustrator/adobe_illustrator-icon.svg" alt="illustrator" width="40" height="40"/> </a> <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/javascript/javascript-original.svg" alt="javascript" width="40" height="40"/> </a> <a href="https://www.jenkins.io" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/jenkins/jenkins-icon.svg" alt="jenkins" width="40" height="40"/> </a> <a href="https://kubernetes.io" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/kubernetes/kubernetes-icon.svg" alt="kubernetes" width="40" height="40"/> </a> <a href="https://www.linux.org/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/linux/linux-original.svg" alt="linux" width="40" height="40"/> </a> <a href="https://www.mongodb.com/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/mongodb/mongodb-original-wordmark.svg" alt="mongodb" width="40" height="40"/> </a> <a href="https://www.photoshop.com/en" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/photoshop/photoshop-line.svg" alt="photoshop" width="40" height="40"/> </a> <a href="https://www.python.org" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/python/python-original.svg" alt="python" width="40" height="40"/> </a> <a href="https://reactjs.org/" target="_blank" rel="noreferrer"> <img src="https://raw.githubusercontent.com/devicons/devicon/master/icons/react/react-original-wordmark.svg" alt="react" width="40" height="40"/> </a> <a href="https://www.vagrantup.com/" target="_blank" rel="noreferrer"> <img src="https://www.vectorlogo.zone/logos/vagrantup/vagrantup-icon.svg" alt="vagrant" width="40" height="40"/> </a> </p>


# Architecture- Infrastructure
![Devops](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/3ebf713b-48d9-4c2d-a890-db37e7e2e798)

**Special thanks to McKay Wrigley and, the owner of Open Source, for his dedication to fostering innovation and collaboration in the open-source community.**

**We are grateful for his contributions to the development of technology and for making projects like ChatBOT UI possible.**

**Special Thanks to Ajay  Ajay yegireddi**

**ChatBOT is an AI language model trained on vast amounts of human conversation data. Itâ€™s capable of generating human-like text responses based on the input it receives. From answering questions to engaging in conversation, ChatBOT can simulate natural language interactions with users, making it an invaluable tool for enhancing user engagement.**

# Prerequisite:.
**Github  Repo Link** :https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps.git

**Launch an AWS T2 Large Instance. Use the image as Ubuntu. You can create a new key pair or use an existing one. Enable HTTP and HTTPS settings in the Security Group and open all ports (not best case to open all ports but just for learning purposes itâ€™s okay).**

![image](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/407f99bc-fe80-48fa-bb28-c2db144c0822)

**Create IAM role**

![1 part](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/8b3190b2-48c4-4f4a-988a-1224a864e7c0)

**Select entity type as AWS service Use case as EC2 and click on Next**

![part2](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/25cd49c2-b8a2-4322-843b-5a87c0638c6e)

**For permission policy select Administrator Access (Just for learning purpose), click Next.**
![part 3](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/a07b6ba4-5a93-479b-9082-fb317cce1e76)

**Provide a Name for Role and click on Create role,you can use any name for role.**

![part 4](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/21ed751b-bbe1-406b-8955-2816db3aaeb7)

**Role is created.**

![part 5](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/4fc1d641-af56-4744-8429-90d5fbe7ea86)

**Now Attach this role to Ec2 instance that we created earlier, so we can provision cluster from that instance.**

**Go to EC2 Dashboard and select the instance.**

**Click on Actions â€“> Security â€“> Modify IAM role.**

![part 6](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/f8ea6205-bd01-4d12-a6b3-f7b78d8703c2)

**Select the Role that created earlier and click on Update IAM role.**
![part 7](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/0a921d3d-9814-4995-996d-bd42c900e961)

**Connect the instance to Mobaxtreme or Putty**

- Install Jenkins, Docker and Trivy
- To Install Jenkins
- Connect to your console, and enter these commands to Install Jenkins

 ```sh
 vi jenkins.sh
 ```

 ```sh
 #!/bin/bash
sudo apt update -y
wget -O - https://packages.adoptium.net/artifactory/api/gpg/key/public | tee /etc/apt/keyrings/adoptium.asc
echo "deb [signed-by=/etc/apt/keyrings/adoptium.asc] https://packages.adoptium.net/artifactory/deb $(awk -F= '/^VERSION_CODENAME/{print$2}' /etc/os-release) main" | tee /etc/apt/sources.list.d/adoptium.list
sudo apt update -y
sudo apt install temurin-17-jdk -y
/usr/bin/java --version
curl -fsSL https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key | sudo tee \
                  /usr/share/keyrings/jenkins-keyring.asc > /dev/null
echo deb [signed-by=/usr/share/keyrings/jenkins-keyring.asc] \
                  https://pkg.jenkins.io/debian-stable binary/ | sudo tee \
                              /etc/apt/sources.list.d/jenkins.list > /dev/null
sudo apt-get update -y
sudo apt-get install jenkins -y
sudo systemctl start jenkins
```
```sh
sudo chmod 777 jenkins.sh
sudo su   #move into root and run
./jenkins.sh    # this will installl jenkins
```

**Once Jenkins is installed, you will need to go to your AWS EC2 Security Group and open Inbound Port 8080, since Jenkins works on Port 8080.**

**Now, grab your Public IP Address**

```sh
<EC2 Public IP Address:8080>
sudo cat /var/lib/jenkins/secrets/initialAdminPassword
```

![part 8](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/ea7c536d-5980-43c0-b663-122d92037e1f)

**Unlock Jenkins using an administrative password and install the suggested plugins.**

![part 9](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/91ce3c02-187f-494f-a215-2ac2cee705b4)

**Jenkins will now get installed and install all the libraries.**

![part 10](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/780c7089-f0c9-4ebc-b2d0-1c7b11dd7bdd)

**Create a user click on save and continue.**

**Jenkins Getting Started Screen.**

![part 11](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/58cd9b91-e4ce-498e-89ff-4ef394e2fbb0)

**Install Docker**
```sh
sudo apt-get update
sudo apt-get install docker.io -y
sudo usermod -aG docker $USER   #my case is ubuntu
newgrp docker
sudo chmod 777 /var/run/docker.sock
```

**After the docker installation, we create a sonarqube container (Remember to add 9000 ports in the security group).**

```sh
docker run -d --name sonar -p 9000:9000 sonarqube:lts-community
```

![part 12](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/0b76102a-dc53-489a-8efd-a2bc336260a9)

**Now our Sonarqube is up and running**


![part 13](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/b05e6e81-0bfd-416d-817e-47f6ab1f30cf)

**Enter username and password, click on login and change password**

```sh
username admin
password admin
```

![part 14](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/4aa10a13-ea0e-48e5-8ebc-13736e95f327)

**Update New password, This is Sonar Dashboard.**

![part 15](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/100cc850-ea1d-4283-8d22-ac6e06da1749)

**Install Trivy, Kubectl,Terraform**

```sh
vi script.sh
```

```sh
sudo apt-get install wget apt-transport-https gnupg lsb-release -y
wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | gpg --dearmor | sudo tee /usr/share/keyrings/trivy.gpg > /dev/null
echo "deb [signed-by=/usr/share/keyrings/trivy.gpg] https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main" | sudo tee -a /etc/apt/sources.list.d/trivy.list
sudo apt-get update
sudo apt-get install trivy -y
# Install Terraform
sudo apt install wget -y
wget -O- https://apt.releases.hashicorp.com/gpg | sudo gpg --dearmor -o /usr/share/keyrings/hashicorp-archive-keyring.gpg
echo "deb [signed-by=/usr/share/keyrings/hashicorp-archive-keyring.gpg] https://apt.releases.hashicorp.com $(lsb_release -cs) main" | sudo tee /etc/apt/sources.list.d/hashicorp.list
sudo apt update && sudo apt install terraform
# Install kubectl
sudo apt update
sudo apt install curl -y
curl -LO https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
kubectl version --client
# Install AWS CLI
curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"
sudo apt-get install unzip -y
unzip awscliv2.zip
sudo ./aws/install
```

**Give permissions and run script**

```sh
sudo chmod 777 script.sh
./script.sh
```

**Next, we will log in to Jenkins and start to configure our Pipeline in Jenkins**

# Install Plugins like JDK, Sonarqube Scanner, NodeJs, OWASP Dependency Check

# Install Plugin

**Goto Manage Jenkins â†’Plugins â†’ Available Plugins â†’**

**Install below plugins**

**Blue ocean**

**1 â†’ Eclipse Temurin Installer**

**2 â†’ SonarQube Scanner**

**3 â†’ NodeJs Plugin**

**4 â†’ Docker**

**5 â†’ Docker commons**

**6 â†’ Docker pipeline**

**7 â†’ Docker API**

**8 â†’ Docker Build step**

**9 â†’ Owasp Dependency Check**

**10 â†’ Kubernetes**

**11 â†’ Kubernetes CLI**

**12 â†’ Kubernetes Client API**

**13 â†’ Kubernetes Pipeline DevOps steps**

# Configure Java and Nodejs in Global Tool Configuration

**Goto Manage Jenkins â†’ Tools â†’ Install JDK(17) and NodeJs(19)â†’ Click on Apply and Save**

![part 17](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/488f23c6-aa2a-48dc-b356-68d0843ae472)

**Grab the Public IP Address of your EC2 Instance, Sonarqube works on Port 9000, so <Public IP>:9000. Goto your Sonarqube Server.**

**Click on Administration â†’ Security â†’ Users â†’ Click on Tokens and Update Token â†’ Give it a name â†’ and click on Generate Token**

![part 18](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/01ed0c69-ed91-409e-a14c-d8155d9c5f65)

**click on update Token**

![part 19](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/38a3e363-2955-42c2-a07c-6f32a8fdee98)

**Create a token with a name and generate**

![part 20](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/f335e308-2a34-43db-9724-093e3c156727)

**copy Token**

**Go to Jenkins Dashboard â†’ Manage Jenkins â†’ Credentials â†’ Add Secret Text. It should look like this**

![part 21](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/108a9ca8-b8fe-495e-bb53-db242ce9ca7e)

**You will this page once you click on create**

![part 22](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/77f3df7e-40b1-4dcb-a9ca-3143a7f3cd22)

**Now, go to Dashboard â†’ Manage Jenkins â†’ System and Add like the below image.**

![part 23](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/2c1e891a-d20c-4d5e-99c1-8d46e3647968)

**Click on Apply and Save**

**The Configure System option is used in Jenkins to configure different server**

**Global Tool Configuration is used to configure different tools that we install using Plugins**

**We will install a sonar scanner in the tools.**

**Manage Jenkins â€“> Tools â€“> SonarQube Scanner**

![part 24](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/02d6e487-39b5-4065-8cb6-55d03e00c08a)

**In the Sonarqube Dashboard add a quality gate also**

**Administrationâ€“> Configurationâ€“>Webhooks**

![part 25](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/ffcb1877-2602-4471-8b6a-4654ef1ec7c2)

**Click on Create**

![part 26](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/c971a9a6-024b-4a57-957c-495af6450691)

**Add details**

```sh
#in url section of quality gate
<http://jenkins-public-ip:8080>/sonarqube-webhook/
```
![part 27](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/774a7515-a058-470a-9471-6d2fb935fa25)

**To see the report, you can go to Sonarqube Server and go to Projects.**

**First, we configured the Plugin and next, we had to configure the Tool**

**Goto Dashboard â†’ Manage Jenkins â†’ Tools â†’***

![part 28](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/88fdd811-a8a2-4ced-a346-4432a51463a6)

**Click on Apply and Save here.**

**Now, goto Dashboard â†’ Manage Jenkins â†’ Tools â†’**

![part 29](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/7ab2a02c-409e-459f-8dd7-169d911ca224)

**Tools â€“> Terraform add this**

**In Jenkins**

```sh
terraform
```

![part 30](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/f8eb06dd-6d31-43c2-a8de-680ad991983d)

**Go to manage Jenkins â€“> Credentials**

**Add DockerHub Username and Password under Global Credentials**

![part 31](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/9009232f-6597-4915-94bd-84fdb32bb2b5)

**Create EKS Cluster from Jenkins**

- CHANGE YOUR S3 BUCKET NAME IN THE BACKEND.TF
 
**Now create a new job for the Eks provision**

![part 32](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/40bc2cc8-c4e2-4081-98c9-4594475d05b7)

**I want to do this with build parameters to apply and destroy while building only.**

**you have to add this inside job like the below image**

![part 33](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/57027153-93bb-4e72-9ac1-53d922db0f3e)

**Letâ€™s add a pipeline**

```sh
pipeline{
    agent any
    stages {
        stage('Checkout from Git'){
            steps{
                git branch: 'legacy', url: 'https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps.git'
            }
        }
        stage('Terraform version'){
             steps{
                 sh 'terraform --version'
             }
        }
        stage('Terraform init'){
             steps{
                 dir('Eks-terraform') {
                      sh 'terraform init'
                   }
             }
        }
        stage('Terraform validate'){
             steps{
                 dir('Eks-terraform') {
                      sh 'terraform validate'
                   }
             }
        }
        stage('Terraform plan'){
             steps{
                 dir('Eks-terraform') {
                      sh 'terraform plan'
                   }
             }
        }
        stage('Terraform apply/destroy'){
             steps{
                 dir('Eks-terraform') {
                      sh 'terraform ${action} --auto-approve'
                   }
             }
        }
    }
}
```
**Letâ€™s apply and save and Build with parameters and select action as apply**

![part 34](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/87d0c5f8-f095-414b-9224-830a1456ed49)

- Stage view it will take max 10mins to provision
- Blue ocean output

 ![part 35](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/46e36eb4-00b1-4fff-bd97-5d44c74fb7fe)
 
**Check in Your Aws console whether it created EKS or not.**

  ![part 36](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/38ad9340-66b9-45e2-893d-dc9d457b97e4)

  **Ec2 instance is created for the Node group**
  
![part 37](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/48040e32-8886-47a2-b25f-60606e1afaab)

**Create Job for chatbot clone**

**Add this stage to Pipeline Script**

```sh
pipeline{
    agent any
    tools{
        jdk 'jdk17'
        nodejs 'node19'
    }
    environment {
        SCANNER_HOME=tool 'sonar-scanner'
    }
    stages {
        stage('Checkout from Git'){
            steps{
                git branch: 'legacy', url: 'https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps.git'
            }
        }
        stage('Install Dependencies') {
            steps {
                sh "npm install"
            }
        }
        stage("Sonarqube Analysis "){
            steps{
                withSonarQubeEnv('sonar-server') {
                    sh ''' $SCANNER_HOME/bin/sonar-scanner -Dsonar.projectName=Chatbot \
                    -Dsonar.projectKey=Chatbot '''
                }
            }
        }
        stage("quality gate"){
           steps {
                script {
                    waitForQualityGate abortPipeline: false, credentialsId: 'Sonar-token'
                }
            }
        }
        stage('OWASP FS SCAN') {
            steps {
                dependencyCheck additionalArguments: '--scan ./ --disableYarnAudit --disableNodeAudit', odcInstallation: 'DP-Check'
                dependencyCheckPublisher pattern: '**/dependency-check-report.xml'
            }
        }
        stage('TRIVY FS SCAN') {
            steps {
                sh "trivy fs . > trivyfs.json"
            }
        }
        stage("Docker Build & Push"){
            steps{
                script{
                   withDockerRegistry(credentialsId: 'docker', toolName: 'docker'){
                       sh "docker build -t chatbot ."
                       sh "docker tag chatbot sanjovarghese484/chatbot:latest "
                       sh "docker push sanjovarghese484/chatbot:latest "
                    }
                }
            }
        }
        stage("TRIVY"){
            steps{
                sh "trivy image sanjovarghese484/chatbot:latest > trivy.json"
            }
        }
        stage ("Remove container") {
            steps{
                sh "docker stop chatbot | true"
                sh "docker rm chatbot | true"
             }
        }
        stage('Deploy to container'){
            steps{
                sh 'docker run -d --name chatbot -p 3000:3000 sanjovarghese484/chatbot:latest'
            }
        }
    }
}
    
```
**Apply and Save and click on Build**

-stage view

![part 38](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/84ff77e1-b6b5-4c1d-b346-a11614b05ebf)

![part 39](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/2ff3cc1f-c60d-499f-a285-8d04e5e5151a)

**You can see the report has been generated and the status shows as passed. You can see that there are 5.3k lines it scanned. To see a detailed report, you can go to issues.**

**You will see that in status, a graph will also be generated and Vulnerabilities.**

![part 40](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/b7c50e28-a3e3-4de1-a1f5-aa0b6ebf0e25)

- Trivy Container scan report

![part 41](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/3eaa60e5-e752-4f4f-90ea-ab67089a4e96)

- Trivy File scan report

![part 42](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/5ccca080-9cf6-4ad8-bb22-fb6db06775e9)

**<Jenkins-public-ip:3000>**

**You will get this output**

![part 43](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/5d80e1f2-81bc-41b5-b608-7e119c712227)

- Click on openai.com to generate the API TOKEN
- Click on Create new secret key

![part 44](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/d163bf21-4100-4c5f-bb4c-b7e9ddac5551)

**Give Name and click on Create**

![part 45](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/2d0da726-72e1-4f2d-993f-e287351ccc51)

**Copy Token and use**

![part 46](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/873c89ba-b334-4f19-811b-f7734472681c)

- Come back to chatbot UI that we deployed and bottom of the page you will see OpenAI API key and give the Generated key and click on save(RIGHT MARK)

![part 47](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/9cabc770-eca3-44ba-a8c9-0386f8387fff)

**You will see page like this**
**You can ask questions Now**

![part 48](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/2dacef11-648c-4738-8d15-e7874cb39e78)

- Or you can generate from Rapidapi.com

- https://rapidapi.com/hub

- Now In the Jenkins Instance

**Give this command**

```sh
aws eks update-kubeconfig --name <clustername> --region <region>
```
**It will Generate an Kubernetes configuration file**

**Here is the path for config file**

```sh
cd .kube
cat config
```
- copy the file that generates
 
**Save it in your local file explorer, at your desired location with any name as text file.**

![part 49](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/7d9ef337-deb5-4b8d-af75-177c57680fb4)

**Letâ€™s add the Final script with Kubernetes**

**Go to manage Jenkins â€“> manage credentials â€“> Click on Jenkins global â€“> add credentials**

**Select Kind as Secret file and choose the file that you saved in your local for kubernetes configuration.**

![part 50](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/6c34944c-2fd1-4d67-bdb6-8ef9c9745b0d)

```sh
stage('Deploy to kubernets'){
            steps{
                script{
                    withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'k8s', namespace: '', restrictKubeConfigAccess: false, serverUrl: '') {
                       sh 'kubectl apply -f k8s/chatbot-ui.yaml'
                  }
                }
            }
        }
```
**Complete script**

**Dont forgot to update the Image in chatbot-ui yml file**

```sh
pipeline{
    agent any
    tools{
        jdk 'jdk17'
        nodejs 'node19'
    }
    environment {
        SCANNER_HOME=tool 'sonar-scanner'
    }
    stages {
        stage('Checkout from Git'){
            steps{
                git branch: 'legacy', url: 'https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps.git'
            }
        }
        stage('Install Dependencies') {
            steps {
                sh "npm install"
            }
        }
        stage("Sonarqube Analysis "){
            steps{
                withSonarQubeEnv('sonar-server') {
                    sh ''' $SCANNER_HOME/bin/sonar-scanner -Dsonar.projectName=Chatbot \
                    -Dsonar.projectKey=Chatbot '''
                }
            }
        }
        stage("quality gate"){
           steps {
                script {
                    waitForQualityGate abortPipeline: false, credentialsId: 'Sonar-token'
                }
            }
        }
        stage('OWASP FS SCAN') {
            steps {
                dependencyCheck additionalArguments: '--scan ./ --disableYarnAudit --disableNodeAudit', odcInstallation: 'DP-Check'
                dependencyCheckPublisher pattern: '**/dependency-check-report.xml'
            }
        }
        stage('TRIVY FS SCAN') {
            steps {
                sh "trivy fs . > trivyfs.json"
            }
        }
        stage("Docker Build & Push"){
            steps{
                script{
                   withDockerRegistry(credentialsId: 'docker', toolName: 'docker'){
                       sh "docker build -t chatbot ."
                       sh "docker tag chatbot sanjovarghese484/chatbot:latest "
                       sh "docker push sanjovarghese484/chatbot:latest "
                    }
                }
            }
        }
        stage("TRIVY"){
            steps{
                sh "trivy image sanjovarghese484/chatbot:latest > trivy.json"
            }
        }
        stage ("Remove container") {
            steps{
                sh "docker stop chatbot | true"
                sh "docker rm chatbot | true"
             }
        }
        stage('Deploy to container'){
            steps{
                sh 'docker run -d --name chatbot -p 3000:3000 sanjovarghese484/chatbot:latest'
            }
        }
        stage('Deploy to kubernets'){
            steps{
                script{
                    withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'k8s', namespace: '', restrictKubeConfigAccess: false, serverUrl: '') {
                       sh 'kubectl apply -f k8s/chatbot-ui.yaml'
                  }
                }
            }
        }
    }
```

**Apply and save , Run the build to deploy to eks**

![part 51](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/b81dcc40-06cc-49d8-97bd-2e37c1233e2d)

**In the Jenkins give this command**

```sh
kubectl get all
kubectl get svc #use anyone
```
- Here it will generate loadbalancer DNS dont forgot.

![part 52](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/b7368122-b851-4e64-ac70-a2b9161373c7)

**Open the load-balancer port to the Cluster EC2 instance**

**otherwise it wont give output**

**EXTERNAL IP IN browser gives output**

- output:

![part 53](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/8c0d78b2-2672-492a-8579-4e42385dfb09)

**Do the same process and add key to get output**
**Here is sample query output i used**

![a1bbe788-6046-462d-9249-b24c13eccf44](https://github.com/Sanjo-varghese/chatbot-ui--DevSecOps/assets/116708794/26ed8f70-8286-421b-a87d-f1a3968a9b8c)

- DESTRUCTION

**Update the pipeline with this code and Run again to remove the deployment and container**

 ```sh
pipeline{
    agent any
    stages {
        stage ("Remove container") {
            steps{
                sh "docker stop chatbot | true"
                sh "docker rm chatbot | true"
             }
        }
        stage('Deploy to kubernets'){
            steps{
                script{
                    withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'k8s', namespace: '', restrictKubeConfigAccess: false, serverUrl: '') {
                       sh 'kubectl delete -f k8s/chatbot-ui.yaml'
                  }
                }
            }
        }
        stage('scan cluster'){
            steps{
                script{
                    withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'k8s', namespace: '', restrictKubeConfigAccess: false, serverUrl: '') {
                       sh 'trivy k8s --report summary cluster'
                  }
                }
            }
        }
    }
```

**The above Script will remove Loadbalancer from Ec2 and removes deployment.**

**Go to EKS job to destroy cluster**

**Select Build with parameters and select destory and build**
**It will Take 6 Minutes to remove the EKS**

**Delete the EC2 instance at End.**

# Thanks
**Sanjo Varghese**
